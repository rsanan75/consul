<% provide :title do %><%= t("customtext.campaigns.title") %><% end %>
<% content_for :canonical do %>
  <%= render "shared/canonical", href: proposals_url %>
<% end %>

<main>
  <% if [
          @search_terms,
          @advanced_search_terms,
          @tag_filter,
          params[:retired].present?,
          params[:selected].present?
        ].any? %>
    <div class="highlight no-margin-top padding margin-bottom">
      <div class="row">
        <div class="small-12 column">
          <% if @search_terms || @advanced_search_terms %>
            <h2><%= t("shared.search_results") %></h2>
            <p>
              <%= page_entries_info @proposals %>
              <% if !@advanced_search_terms %>
                <%= t("proposals.index.search_results_html", count: @proposals.size, search_term: @search_terms) %>
              <% end %>
            <p>
          <% elsif @tag_filter %>
            <h2><%= t("shared.search_results") %></h2>
            <p>
              <%= page_entries_info @proposals %>
              <%= t("proposals.index.filter_topic", count: @proposals.size, topic: @tag_filter) %>
            </p>
          <% elsif params[:retired].present? %>
            <h2><%= t("customtext.campaigns.retired_title") %></h2>
          <% elsif params[:selected].present? %>
            <h2><%= t("proposals.index.selected_proposals") %></h2>
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <div class="help-header no-margin-top margin-bottom">
    <div class="row">
      <div class="small-12 column" data-magellan>
        <h1 class="inline-block"><%= t("customtext.campaigns.title") %></h1>
        <div class="float-right-medium">
          <%= render "shared/search_form",
             search_path: proposals_path(page: 1),
             i18n_namespace: "proposals.index.search_form" %>
        </div>
      </div>
    </div>
  </div>

    
  <% end %>

  <% if show_recommended_proposals? %>
    <%= render "shared/recommended_index", recommended: @recommended_proposals,
                                           disable_recommendations_path: recommendations_disable_proposals_path,
                                           namespace: "proposals" %>
  <% end %>

  <div class="row proposals-listing">
    
        
<% if params[:retired].present? && params[:retired] == 'all' %>
<ul class="no-bullet submenu">
    <li class="inline-block">
      <a href="/campaigns">
        <h2>
          <%= t("customtext.proposal_pages.active_tab_label") %>
</h2></a>    </li>
    <li class="inline-block">
      <a class="is-active" href="#">
        <span>
          <%= t("customtext.proposal_pages.completed_tab_label") %>
</span></a>    </li>
<li class="inline-block float-right proposal-short-link">
          <a href="#proposals"><%= t("customtext.proposal_pages.proposal_shortlink_label") %></a>
        </li>
</ul>
  <% @campaigns.each do |campaing| %>
  <details class="retired-campaign">
    <summary><%= campaing.title %><span class="float-right"><%= t("customtext.campaigns.end_date") %>: <%= campaing.ends_at.strftime("%d/%m/%Y") %></span></summary>
  
    <div class="active-campaign proposal-show">
    <h3 class="text-center"><%= campaing.title %></h3>
    <%= auto_link_already_sanitized_html wysiwyg(campaing.description) %>

    </div>
    <div class="winning_proposal-<%= campaing.id %>">
    </div>
  </details>
  <% end %>
  <div class="all-winning-proposal">
	  <%= render partial: "/proposals/proposal", object: @winning_proposal %>
     
  </div>
<% else %>
<ul class="no-bullet submenu">
    <li class="inline-block">
      <a class="is-active" href="#">
        <h2>
          <%= t("customtext.proposal_pages.active_tab_label") %>
</h2></a>    </li>
    <li class="inline-block">
      <a class="" href="/campaigns?retired=all">
        <span>
          <%= t("customtext.proposal_pages.completed_tab_label") %>
</span></a>    </li>
        <li class="inline-block float-right proposal-short-link">
          <a href="#proposals"><%= t("customtext.proposal_pages.proposal_shortlink_label") %></a>
        </li>
</ul>
      <%= render partial: "campaing", collection: @campaigns %>
<% end %>
      <% if has_banners? %>
        <%= render "shared/banner" %>
      <% end %>

      <% if show_featured_proposals? %>
        <div id="featured-proposals" class="row featured-proposals">
          <div class="small-12 column">
            <h2>
              <%= t("proposals.index.featured_proposals") %>
            </h2>
          </div>
          <% @featured_proposals.each do |featured_proposal| %>
            <%= render "featured_proposal", proposal: featured_proposal %>
          <% end %>
        </div>
      <% end %>

      

      

      <% unless params[:selected].present? %>
            <% if params[:retired].present? && params[:retired] == 'all' %>
            <% else %>
            <div class="shared-order-links"><%= render "shared/order_links", i18n_namespace: "proposals.index" %></div>
            <% end %>
      <% end %>
      <% if params[:retired].present? && params[:retired] == 'all' %>
      <div id="proposals" class="proposals-list small-12 medium-12 column">
            <% else %>
            <div id="proposals" class="proposals-list small-12 medium-9 column">
            <% end %>

      <% if @proposals.any? %>
        <div class="show-for-small-only">
          <%= link_to t("proposals.index.start_proposal"),
                      new_proposal_path,
                      class: "button expanded" %>
        </div>
      <% end %>

      <div id="proposals-list">
        <% if @proposals.any? || current_user.blank? %>
          <% if proposals_default_view? %>
            <%= render partial: "proposals/proposal", collection: @proposals %>
          <% else %>
            <% @proposals.each do |proposal| %>
              <%= render partial: "/proposals/proposal_minimal", locals: { proposal: proposal } %>
            <% end %>
          <% end %>
        <% else %>
          <%= empty_recommended_proposals_message_text(current_user) %>
        <% end %>
        <%= paginate @proposals %>
        <% if false %>
        <% unless @search_terms || @advanced_search_terms || @tag_filter %>
          <div id="section_help" class="margin" data-magellan-target="section_help">
            <p class="lead">
              <strong><%= t("proposals.index.section_footer.title") %></strong>
            </p>
            <p><%= t("proposals.index.section_footer.description") %></p>
          </div>
        <% end %>
        <% end %>
      </div>
    </div>
<% if params[:retired].present? && params[:retired] == 'all' %>
            <% else %>
    <div class="small-12 medium-3 column">
      <aside class="margin-bottom ">
        <%= link_to t("proposals.index.start_proposal"),
                    new_proposal_path,
                    class: "button expanded" %>

        <div class="sidebar-divider"></div>
        <h2 class="sidebar-title"><%= t("proposals.index.selected_proposals") %></h2>
        <br>
        <p class="small">
          <%= link_to t("proposals.index.selected_proposals_link"), proposals_path(selected: "all") %>
        </p>

        <% if params[:retired].blank? %>
          <%= render "categories" %>
        <% end %>
        <% if false %><%= render "geozones" %>
        <%= render "retired" %>
        <%= render "shared/tag_cloud", taggable: "proposal" %>
        <%= render "proposals_lists" %>
        <% end %>
        <%= render "shared/download_links", downloadable: "proposal" %>
      </aside>
    </div>
<% end %>
  </div>
</main>
